type vendor_charger, domain;
type vendor_charger_exec, exec_type, vendor_file_type, file_type;

init_daemon_domain(vendor_charger)

allow vendor_charger self:capability sys_boot;
allow vendor_charger self:cap_userns sys_boot;
allow vendor_charger self:capability2 block_suspend;
allow vendor_charger self:cap2_userns block_suspend;
allow vendor_charger system_suspend_server:binder { call transfer };
allow system_suspend_server charger:binder transfer;
allow vendor_charger system_suspend_server:fd use;
allow vendor_charger system_suspend_hwservice:hwservice_manager find;
allow vendor_charger hwservicemanager:binder { call transfer };
allow vendor_charger hidl_manager_hwservice:hwservice_manager find;
allow vendor_charger init:unix_stream_socket connectto;
r_dir_file(vendor_charger, vendor_sysfs_battery_supply)
r_dir_file(vendor_charger, vendor_sysfs_usb_supply)

allow vendor_charger sysfs:dir r_dir_perms;
allow vendor_charger vendor_file:file r_file_perms;
allow vendor_charger vendor_file:dir r_dir_perms;

allow vendor_charger {
    vendor_sysfs_battery_supply
    vendor_sysfs_usb_supply
    vendor_sysfs_graphics
}:{
  file
  lnk_file
} rw_file_perms;

dontaudit vendor_charger device:dir r_dir_perms;
dontaudit vendor_charger self:capability sys_admin;

# Take charger policies via system sepolicy
# Write to /dev/kmsg
allow vendor_charger kmsg_device:chr_file rw_file_perms;

# Read access to pseudo filesystems.
r_dir_file(vendor_charger, rootfs)
r_dir_file(vendor_charger, cgroup)
r_dir_file(vendor_charger, cgroup_v2)

# Allow to read /sys/class/power_supply directory
allow vendor_charger sysfs_type:dir r_dir_perms;

allow vendor_charger self:global_capability_class_set { sys_tty_config };
allow vendor_charger self:global_capability_class_set sys_boot;

wakelock_use(vendor_charger)

allow vendor_charger self:netlink_kobject_uevent_socket create_file_perms;

# Read/write to /sys/power/state
allow vendor_charger sysfs_power:file rw_file_perms;

r_dir_file(vendor_charger, sysfs_batteryinfo)

# Read /sys/fs/pstore/console-ramoops
# Don't worry about overly broad permissions for now, as there's
# only one file in /sys/fs/pstore
allow vendor_charger pstorefs:dir r_dir_perms;
allow vendor_charger pstorefs:file r_file_perms;

allow vendor_charger sysfs_leds:dir { search };
allow vendor_charger sysfs_leds:file { rw_file_perms };
allow vendor_charger sysfs_leds:lnk_file { r_file_perms };

allow vendor_charger graphics_device:dir r_dir_perms;
allow vendor_charger graphics_device:chr_file rw_file_perms;
allow vendor_charger input_device:dir r_dir_perms;
allow vendor_charger input_device:chr_file r_file_perms;
allow vendor_charger tty_device:chr_file rw_file_perms;
allow vendor_charger proc_stat:file { r_file_perms };
allow vendor_charger proc_sysrq:dir { search };
allow vendor_charger proc_sysrq:file rw_file_perms;
allow vendor_charger properties_device:dir { r_dir_perms };

hal_client_domain(vendor_charger, hal_health)
